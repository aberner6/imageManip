
<!DOCTYPE html>

<html>

<head>
    <title>IMAGES</title>
    <meta charset="utf-8">
    <script src="colorbrewer.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
</head>
<style>
    .results img {
        width: 10%;
        float: left;
        display: block;
    }
    
    .axis path,
    .axis line {
        fill: none;
        stroke: black;
        shape-rendering: crispEdges;
    }
    
    .axis text {
        font-family: sans-serif;
        font-size: 11px;
    }
    
    #check {
        display: none;
        /*position:fixed;*/
        /*left: 100px;*/
        /*top:100px;*/
    }
</style>

<body>
    <div class="results"></div>
    <script>
        var totalButton1 = 0;
        var but1 = [];
        var uniques = [];
        var storeBT = [];
        var storeThis = [];

        var dashArray = "1 5 1 1";


        var dur = 2000;

        var totalButton2 = 0;
        var totalButton3 = 0;
        var totalButton4 = 0;
        var totalButton5 = 0;
        var w = screen.width,
            h = screen.height-200,
            margin = 25;
        var padding = 200;
        var svg = d3.select("body")
            .append("svg")
            .attr("width", w)
            .attr("height", h);
        var parseDate = d3.time.format('%B %d, %Y %I:%M%p').parse;
        var mindate, maxdate, xScale;
        var xAxis = d3.svg.axis();
        var yAxis = d3.svg.axis();

        var centerline = h / 2;

        var mindateBT, maxdateBT, xScaleBT, yScaleBT;
        var parseDateBT = d3.time.format('%a %B %e %H:%M:%S').parse;
        // Fri May 22 11:34:30
        var thisTime = [];
var thisHour = [];
        $(document).ready(function() {
            // https://docs.google.com/spreadsheets/d/1XX6jJc4uu4PsNp7JvQ4dZ8K9cIFnheQbqOe4QQsfZdE/pubhtml
            // https://docs.google.com/spreadsheets/d/1XX6jJc4uu4PsNp7JvQ4dZ8K9cIFnheQbqOe4QQsfZdE/pubhtml
            $.getJSON("https://spreadsheets.google.com/feeds/list/1JHKJm232Adv1GwDNIz5VLyBfg12d6CNl3GrCfs6y-tU/od6/public/values?alt=json", function(data) {
                console.log(data.feed.entry.length)

                // ['a', 'b', 'c'].forEach(function(d, i, arr) {
                //     console.log(d, i, arr)
                //     })
                //returns 

                for (j = 0; j < data.feed.entry.length; j++) {
                    thisTime.push(data.feed.entry[j]['gsx$date']['$t'].replace(" at", ''));
thisHour.push(parseDate(thisTime[j]).getHours())
                    // console.log(data.feed.entry[j]['gsx$imageurl']['$t']);
                    // console.log(data.feed.entry[j]);
                }


                entry = data.feed.entry;
                console.log(entry.length + "length")

                if (thisTime.length > 1) {
                    mindate = new Date("Tue Jun 30 2015 8:00:00 GMT-0400 (EDT)");//parseDate(thisTime[0]);
//parseDate(thisTime[0]);
                    maxD = Date.now(); //parseDate(thisTime[data.feed.entry.length - 1]);
                    maxdate = calcTime("copenhagen", 2);

                    function calcTime(city, offset) {

                        // create Date object for current location
                        d = new Date();

                        // convert to msec
                        // add local time zone offset
                        // get UTC time in msec
                        utc = d.getTime() + (d.getTimezoneOffset() * 60000);

                        // create new Date object for different city
                        // using supplied offset
                        nd = new Date(utc + (3600000 * offset));
                        console.log(nd);
                        return nd;
                        // return time as a string
                        // return "The local time in " + city + " is " + nd.toLocaleString();

                    }
                    xScale = d3.time.scale()
                        .domain([mindate, maxdate])
                        .range([100, w - 100]);

                    // xScaleBT = d3.time.scale()
                    //     .domain([mindateBT, maxdateBT])
                    //     .range([100, w - 100]);

                    xAxis
                        .scale(xScale)
                        .orient("bottom")
                        .ticks(10);
                    svg.append("g")
                        .attr("class", "axis") //Assign "axis" class
                        .attr("transform", "translate(0," + (centerline) + ")")
                        .call(xAxis);


                    console.log(thisTime);
                    var suns = svg.append("g")
                        .attr("id", "sky")
                        .selectAll("img").data(data.feed.entry)
                        .enter()
                        .append("svg:image")
                        //Define clipping path
                        // suns.append("clipPath") //Make a new clipPath
                        //     .attr("id", "chart-area") //Assign an ID
                        //     .append("rect") //Within the clipPath, create a new rect
                        //     .attr("x", function(d, i) {
                        //         console.log(i)
                        //         return i * 100;
                        //     }) //Set rect's position and sizeâ€¦
                        //     .attr("y", 100)
                        //     .attr("width", 10)
                        //     .attr("height", 10)
                    var extraPad = 1;
                    var clicked = false;


    // var minHour = d3.min((parseDate(thisTime[i]).getHours())
var maxHour = d3.max(thisHour, function(j) {
    return j;  //References first value in each subarray
});
var minHour = d3.min(thisHour, function(j) {
    return j;  //References first value in each subarray
});

var scaleIt = d3.scale.linear()
    .domain([minHour, maxHour])
    .range([centerline+100, h-100])

                    suns
                        .attr("clip-path", "url(#chart-area)")
                        .attr("xlink:href", function(d, i) {
                            return data.feed.entry[i]['gsx$imageurl']['$t'];
                        })
.attr("x", function(d, i) {
    return xScale(parseDate(thisTime[i])) * extraPad; //scale based on d.time
})
                        .attr("y", centerline)
                        .attr("width", 50)
                        .attr("height", 50)
                        .transition()
                        .duration(dur)
.attr("y", function(d,i){

    if(i>0){
        if(parseDate(thisTime[i]).getHours()==parseDate(thisTime[i-1]).getHours()||parseDate(thisTime[i]).getHours()==parseDate(thisTime[i-1]).getHours()+1){
                // var thisIndex++;
                // console.log(scaleIt(parseDate(thisTime[i]).getHours()))
                return scaleIt(parseDate(thisTime[i]).getHours());
            }
            else{
                return centerline+100;
            }
        }else{
            return centerline+100;
        }
});
                    suns
                        .on("click", function(d) {
                            if (clicked == false) {
                                d3.select(this)
                                    .transition()
                                    .duration(dur / 2)
                                    .attr("y", centerline+20)
                                    .attr("width", 200)
                                    .attr("height", 200)
                                clicked = true;
                            }
                            if (clicked) {
                                d3.select(this)
                                    .transition()
                                    .delay(dur)
                                    .duration(dur / 4)
                                    .attr("y", function(d,i){
                                        console.log(d)
                                        return h / 2 + 200
                                    })
                                    .attr("width", 50)
                                    .attr("height", 50)
                                clicked = false;
                            }
                        })

                    var imgLine = svg.append("g")
                        .selectAll("line").data(data.feed.entry)
                        .enter()
                        .append("svg:line")
                        .attr("class", "imgLine")
                        .attr("x1", function(d, i) {
                            return xScale(parseDate(thisTime[i])) * extraPad; //scale based on d.time
                        })
                        .attr("x2", function(d, i) {
                            return xScale(parseDate(thisTime[i])) * extraPad; //scale based on d.time
                        })
                        .attr("y1", centerline)
                        .attr("y2", centerline)
                        .attr("stroke", "grey")
                        .attr("stroke-weight", 1)
                        .attr("stroke-dasharray", dashArray)
                        .transition()
                        .duration(dur)
.attr("y2", function(d,i){

    if(i>0){
        if(parseDate(thisTime[i]).getHours()==parseDate(thisTime[i-1]).getHours()||parseDate(thisTime[i]).getHours()==parseDate(thisTime[i-1]).getHours()+1){
                // var thisIndex++;
                // console.log(scaleIt(parseDate(thisTime[i]).getHours()))
                return scaleIt(parseDate(thisTime[i]).getHours());
            }
            else{
                return centerline+100;
            }
        }else{
            return centerline+100;
        }
});
                }
                doButton();
            });
        })




        function doButton() {

            $.getJSON("https://spreadsheets.google.com/feeds/list/1iWrQh4Pc1G7DkyTCJGy2QLSI4sqnCRtjMbxOMh1b2tQ/od6/public/values?alt=json", function(data) {
                // var parseDate = d3.time.format('%B %d, %Y %I:%M%p').parse;
                console.log(data.feed.entry[data.feed.entry.length - 1])
                for (i = 0; i < data.feed.entry.length; i++) {
                    if (data.feed.entry[i]['gsx$device']['$t'] == "wombat_wombat") {
                        but1.push({
                            "buttonIs": data.feed.entry[i]['gsx$button']['$t'],
                            "timeIs": data.feed.entry[i]['gsx$timestamp']['$t'].replace(" at", '')
                        })

                    }
                }


                if (but1.length > 1) {
                    // console.log(unique(but1));
                    unique(but1);

                    function unique(obj) {
                        var stringify = {};
                        for (var i = 0; i < obj.length; i++) {
                            var keys = Object.keys(obj[i]);
                            keys.sort(function(a, b) {
                                return a - b
                            });
                            var str = '';
                            for (var j = 0; j < keys.length; j++) {
                                str += JSON.stringify(keys[j]);
                                str += JSON.stringify(obj[i][keys[j]]);
                            }
                            if (!stringify.hasOwnProperty(str)) {
                                uniques.push(obj[i]);
                                stringify[str] = true;
                            }
                        }
                        return uniques;
                    }
                }

                if (uniques.length > 1) {

                    // mindate = parseDate(uniques[0].timeIs);
                    // maxdate = parseDate(uniques[totalButton1 - 1].timeIs);
                    // x = d3.time.scale()
                    //     .domain([mindate, maxdate])
                    //     .range([10, w - 10]);

                    // var but1Circ = svg.append("g")
                    //     .selectAll("circle").data(uniques)
                    //     .enter()
                    //     .append("svg:circle")
                    //     .attr("class", "button1")
                    //     .attr("cy",centerline)
                    //     .attr("cx", function(d, i) {
                    //         return xScale(parseDate(d.timeIs)); //scale based on d.time
                    //     })
                    //     .attr("r", 10)
                    //     .attr("fill", function(d,i){
                    //         // if(d.buttonIs=="button1"){
                    //         //     return "blue";
                    //         // }
                    //         // if(d.buttonIs=="button4"){
                    //         //     return "red";
                    //         // }
                    //         // if(d.buttonIs=="button3"){
                    //         //     return "grey";
                    //         // }
                    //         "none"
                    //     })
                    //     // .attr("opacity", .5)
                    //     .transition()
                    //     .duration(dur)                       
                    //     .attr("cy", padding/3)


                    var radius = 10;
                    var strokeWeight = 2;

                    // var winCircle = svg.selectAll("win")
                    //     .data(uniques)
                    //     .enter().append("circle")
                    //     .attr("class", function(d, i) {
                    //         return d.buttonIs;
                    //     })
                    //     .attr("cx", function(d, i) {
                    //         // if(d.buttonIs=="button1"){
                    //         // return "blue";
                    //         // }
                    //         // console.log(xScale(parseDate(d.timeIs)))
                    //         return xScale(parseDate(d.timeIs)); //scale based on d.time
                    //         // }
                    //     })
                    //     .attr("r", radius)
                    //     .attr("fill", "none")
                    //     // .attr("stroke-dasharray", "4,4")
                    //     .attr("stroke", function(d, i) {
                    //         if (d.buttonIs == "button1") {
                    //             return "blue";
                    //         }
                    //         if (d.buttonIs == "button2") {
                    //             return "grey";
                    //         }
                    //         if (d.buttonIs == "button3") {
                    //             return "red";
                    //         }
                    //     })
                    //     .attr("stroke-width", strokeWeight)
                    //     .attr("opacity", .5)
                    //     .attr("cy", centerline)
                    //     .transition()
                    //     .duration(dur)
                    //     .attr("cy", padding / 3)


                       



                    var checks = svg.selectAll("img").data(uniques)
                        .enter()
                        .append("svg:image")
                    checks
                        .attr("xlink:href", function(d,i){
                            if(d.buttonIs == "button1"){ //cloud
                                return "idea.png";
                            }
                            if(d.buttonIs == "button3"){
                                return "thunder.png";
                            }
                            if(d.buttonIs == "button2"){
                                return "star.png";
                            }
                        })
                        // .attr("id", "checks")
                        .attr("x", function(d, i) {
                            // if (d.buttonIs == "button1") {
                                // console.log(parseDate(d.timeIs)+"andtime"+i)
                                return xScale(parseDate(d.timeIs)); //scale based on d.time
                            // } else {
                                // return -w * 2;
                            // }
                        })
                        .attr("opacity", 0)
                        .attr("y", centerline)
                        .attr("width", 20)
                        .attr("height", 20)
                        .attr("opacity",1)
                        .transition()
                        .duration(dur)
                        .attr("y", function(d,i){
                            if(d.buttonIs == "button1"){
                                return margin*2;
                            }
                            if(d.buttonIs == "button3"){
                                return margin*3;
                            }
                            if(d.buttonIs == "button2"){
                                return margin*4;
                            }
                        }) 
                    var but1Line = svg.append("g")
                        .selectAll("line").data(uniques)
                        .enter()
                        .append("svg:line")
                        .attr("class", function(d){
                            return d.buttonIs;
                        })
                        .attr("x1", function(d, i) {
                            return xScale(parseDate(d.timeIs))+10; //scale based on d.time
                        })
                        .attr("x2", function(d, i) {
                            return xScale(parseDate(d.timeIs))+10; //scale based on d.time
                        })
                        .attr("y1", centerline)
                        .attr("y2", centerline)
                        .attr("stroke", "grey")
                        .attr("stroke-weight", .5)
                        .attr("opacity", .2)
                        // .attr("stroke-dasharray", dashArray)
                        // .attr("stroke-dasharray", "1 2 2 2")
                        .transition()
                        .duration(dur)
                        .attr("y2", function(d,i){
                            if(d.buttonIs == "button1"){
                                return margin*2+10;
                            }
                            if(d.buttonIs == "button3"){
                                return margin*3+10;
                            }
                            if(d.buttonIs == "button2"){
                                return margin*4+10;
                            }
                            else{
                                return centerline;
                            }
                        });
                                doBT();
                }
            })
        }
        var oColor;
        var maxTime;
        var maxActivity = 100;
        var minActivity = 0;
        var distData = [];
        var names = [];
        var uniqueNames = [];
        var zeroBT = [];
        var oneBT = [];
        var twoBT = [];
        var threeBT = [];
        var fourBT = [];
        var fiveBT = [];
        var sixBT = [];
        var sevenBT = [];

        var specialBT = [];

var totalK = [];

var specialStore = [];
var trackTotal = [];
        function doBT() {
// https://docs.google.com/document/d/1LNbO-5UUnWgNv4T6asMBW4lczOJfgwtCJQpc-vfGiP0/pub     
// https://docs.google.com/feeds/list/1LNbO-5UUnWgNv4T6asMBW4lczOJfgwtCJQpc-vfGiP0/od6/public/values?alt=json       


// "https://dl.dropboxusercontent.com/u/97059/fitbit/fitbit.json"
            $.getJSON("https://spreadsheets.google.com/feeds/list/1CK2L-NwoswZ9l4-MU4tbu-bwt3eI1Oot_bbXkuFNl8c/od6/public/values?alt=json", function(data) {

                for (j = 0; j < data.feed.entry.length; j++) {
                    if (parseInt(data.feed.entry[j]['gsx$dist']['$t']) < 0) {

                        storeBT.push({
                            "device": data.feed.entry[j]['gsx$device']['$t'],
                            "timeIs": data.feed.entry[j]['gsx$timestamp']['$t'], //.replace(" at", '')
                            "dist": data.feed.entry[j]['gsx$dist']['$t']
                        })
                    } else {}
                    names.push(data.feed.entry[j]['gsx$device']['$t']);
                    if (parseInt(data.feed.entry[j]['gsx$dist']['$t']) < 0) {
                        distData.push((parseInt(data.feed.entry[j]['gsx$dist']['$t'])) * -1);
                    }
                    $.each(names, function(i, el) {
                        if ($.inArray(el, uniqueNames) === -1) {
                            uniqueNames.push(el);
                        }
                    });
                }
                if (storeBT.length > 0) {
                    oColor = d3.scale.ordinal()
                        .domain([uniqueNames])
                        .range(colorbrewer.BuGn[9]);

                    mindateBT = parseDateBT(storeBT[0].timeIs);
                    maxdateBT = parseDateBT(storeBT[storeBT.length - 1].timeIs) //Date.now(); //parseDate(thisTime[data.feed.entry.length - 1]);

                    minActivity = d3.min(d3.values(distData));
                    maxActivity = d3.max(d3.values(distData));

                    yScaleBT = d3.scale.linear()
                        .domain([minActivity, maxActivity])
                        .range([centerline, centerline / 2])
                    yAxis
                        .scale(yScaleBT)
                        .orient("left")
                        .ticks(4);
                    // svg.append("g")
                    //     .attr("class", "axis") //Assign "axis" class
                    //     .attr("transform", "translate(100," + (0) + ")")
                    //     .call(yAxis);

                    xScaleBT = d3.time.scale()
                        .domain([mindateBT, maxdateBT])
                        .range([100, w - 100]);
                }
                if (mindateBT) {

                    var hHere = 10;
                    var quant = 0;
                    var multiplier = 10;


                    var blRect = svg.append("g").attr("class", "bt1")
                        .selectAll("rect").data(storeBT)
                        .enter()
                        .append("svg:rect")
                        .attr("class", function(d,i){
    // if (parseInt(d.dist) > -50) {
    //     for (j = 0; j < uniqueNames.length; j++) {
    //         specialStore.push({"device":uniqueNames[j],"dist":d.dist,"timestamp":d.timeIs})
    //     }
    // }
                            return d.dist+"bt1"
                        })
                        .attr("x", function(d, i) {
                            return xScaleBT(parseDateBT(d.timeIs)); //scale based on d.time
                        })
.attr("y", function(d, i) {
    if (parseInt(d.dist) > -50) {
        for (j = 0; j < uniqueNames.length; j++) {
            if (d.device == uniqueNames[j]) {
                return centerline - j * multiplier * 1.5;
            }
        }
        }
        else {
            for (j = 0; j < uniqueNames.length; j++) {
                if (d.device == uniqueNames[j]) {
                    return centerline / 1.5 - j * multiplier * 1.5;
                }
            }
        }
                        })
                        .attr("width", 5)
                        .attr("height", hHere)
                        .attr("fill", function(d) {
                            for (j = 0; j < uniqueNames.length; j++) {
                                if (d.device == uniqueNames[j]) {
                                    return oColor(uniqueNames[j]);
                                }
                            }
                        })
                        .attr("opacity", function(d) {
                            return 1;
                        })

var uniqueKDone = false;
    function keyConsolidation(givenKey,i) { 
        var total = 0;
        for (i = 0;i<specialStore.length; i++){ 
            if(specialStore[i].device == givenKey){
                total++;
            }else{
            }
        }
         return total;
     } 
for (i = 0; i<uniqueNames.length; i++){
   totalK[i]= keyConsolidation(uniqueNames[i])
    uniqueKDone=true;   
}
if(uniqueKDone){
    console.log(totalK)
    makeText(totalK);
}
// makeText(); 


                    //  //The line SVG Path we draw
                    // var lineGraph = svg.append("path")
                    //                     .attr("d", lineFunction(sevenBT))
                    //                     .attr("stroke", color(7))
                    //                     .attr("stroke-width", strokePath)
                    //                     .attr("fill", "none"); 
                }
            })
        }



function makeText(totalK){

d3.selectAll(".summary").remove();    
var sumText = svg.selectAll("summary")
    .data((totalK))
    .enter()
    .append("text").attr("class", "summary")
    .attr("font-size",14)
    .attr("fill",function(d,i){
        return oColor(i);
    })
    .attr("x", function(d,i){
        return w/3 + i*10;
    })
    .attr("y", h)
    .html(function(d,i){
        return (d)+" Time in Workshop"; 
    })
}
        //          if(data.feed.entry[i]['gsx$button']['$t']=="button1"){
        //             totalButton1++;
        //             but1.push({"total":totalButton1, "time":data.feed.entry[i]['gsx$timestamp']['$t']})
        //             return "buttonCirc1";                       
        //         }
        //         if(data.feed.entry[i]['gsx$button']['$t']=="button2"){
        //             totalButton2++;
        //             return "buttonCirc2";                       
        //         }
        //         if(data.feed.entry[i]['gsx$button']['$t']=="button3"){
        //             totalButton3++;
        //             return "buttonCirc3";
        //         }
        //         if(data.feed.entry[i]['gsx$button']['$t']=="button4"){
        //             totalButton4++;
        //             return "buttonCirc4";
        //         }
        //         if(data.feed.entry[i]['gsx$button']['$t']=="button5"){
        //             totalButton5++;
        //             return "buttonCirc5";
        //         }
        //     })









        // $.getJSON("https://spreadsheets.google.com/feeds/list/1Ds8TAVMTrV8jFZovhnOWe4OxuehaeXlOAhyrlugI4ss/od6/public/values?alt=json", function(data) {
        //     console.log(data.feed.entry.length);
        //     var dataLength = data.feed.entry.length;
        //   //first row "title" column
        //     for(i=0; i<dataLength; i++){
        //       console.log(data.feed.entry[i]['gsx$imageurl']['$t'])//data.feed.entry[i]['gsx$caption']['$t'])
        //         $('.results').prepend('<img src="'+ data.feed.entry[i]['gsx$imageurl']['$t']+'" alt="'+data.feed.entry[i]['gsx$caption']['$t']+'"/>');
        //     }

        //    entry = data.feed.entry;
        //     console.log(entry)
        // });
        // })




    </script>
</body>
<!-- <body> -->
<!-- <canvas id="myCanvas" width="1300" height="800"> -->
<!-- Insert fallback content here -->
<!-- </canvas> -->
<!-- </body> -->

</html>